<?php $this->render( 'include/header', true ); ?>
<?php $this->render( 'include/lefter', true );
$album = $this->list;
?>
<script type="text/javascript" src="/static/js/popup_util.js"></script>
<script type="text/javascript" src="/static/js/msg_util.js"></script>
		<div id="main-content"> <!-- Main Content Section with everything -->
		
			
			<div class="content-box ">

				<div class="content-box-header">

					<h3>区块添加管理</h3>
					<ul class="content-box-tabs">
						<li><a href="/album/index/?islist=1" class="default-tab">列表</a></li> <!-- href must be unique and match the id of target div -->
						<!--<li><a href="/vipalbum/index/">新增</a></li>-->
					</ul>


				</div> <!-- End .content-box-header -->

				<div class="content-box-content">

					<div class="tab-content default-tab" id="refresh">

						<table id="selected">
							<tr id="lis">
								<th><h3>ID</h3></th>
								<th><h3>一级栏目</h3></th>
								<th><h3>二级栏目</h3></th>
								<th><h3>操作</h3></th>
							</tr >
							<?php
							foreach($this->data as $v)
							{
								echo "<tr id=\"m_".$v['id']."\">";
								echo "<td>".$v['id']."</td>";
								echo "<td>".$v['column']."</td>";
								echo "<td><table><tr>
									<td width='50%'>ID</td>
									<td width='50%'>栏目名称</td>";
									$nodes = unserialize($v['nodes']);
									foreach($nodes[0] as $key=>$va){
										echo "<tr>";
										if($va['nid'])
										{
											echo "<td>".$va['nid']."</td>";
											echo "<td>".$va['name']."|url:".$va['url']."|curr_submenu：".$va['curr_submenu']."</td>";
										}
										echo "</tr>";
									}
								echo "</tr></table></td>";
								echo "<td><a href='javascript:void(0)' onclick='del()'><img src='/static/admin/images/icons/cross.png' title='删除'></a>&nbsp;<a href='javascript:void(0)' onclick='addAuth(".$v['id'].")'><img src='/static/admin/images/icons/pencil.png' title='添加权限'></a>&nbsp;&nbsp[<a href='/auth/editsection/?id=".$v['id']."'>修改栏目信息</a>]</td>";
								echo "</tr>";
							}
							?>
						</table>
					</div> <!-- End #tab3 -->
				<hr>
				<details><summary><b>添加区块权限</b></summary>
				<hr>
						<div>
							<form method="post" id="sectionform" name="sectionform">
							<fieldset>
								<span id="section">
								<p>一级栏目： <select name="id" id="id">
								<?php foreach($this->data as $v){
									echo "<option value=".$v['id'].">".$v['column']."</option>";
								}
								?>
								</select><span id="c_title"></span>&nbsp;【<a href="javascript:void()" onclick="addsection()">点此新增</a>】</p>
								<p>二级栏目： <input class="text-input small-input" type="search" name="nodes" id="nodes" value="" required="required"/></p>
								<p>二级栏目URL：<input type="text" value="" name="url" id="url"></p>
								<p>curr_submenu：<input type="text" class="text-input small-input" value="" name="curr_submenu" id="curr_submenu"></p>
								<p><input class="button" type="button" value="提交" onclick=" return bottonForm()">&nbsp;<span class="notic" style="color:red"></span></p>
								</span>
							</fieldset> <!-- End #tab3 -->
							</form>
						</div>
					</details>
<!--<?php $this->render( 'include/pager', true ); ?>-->
				</div> <!-- End .content-box-content -->
			
				
			</div> <!-- End .content-box -->


<?php $this->render( 'include/footer', true ); ?>
<script>
	function addsection()
	{
		var str = '<p>一级栏目： <input class="text-input small-input" type="search" name="column" id="column" value="" required="required"/><span id="c_title"></span></p><p>curr_menu：<input type="text" class="text-input small-input" value="" name="curr_menu" id="curr_menu"></p><p>二级栏目： <input class="text-input small-input" type="search" name="nodes" id="nodes" value="" required="required"/></p><p>二级栏目URL：<input class="text-input small-input" type="search" name="url" id="url" value=""></p><p>curr_submenu：<input type="text" class="text-input small-input" value="" name="curr_submenu" id="curr_submenu"></p><p><input class="button" type="button" value="新增" onclick=" return submitForm()">&nbsp;<span class="notic" style="color:red"></span></p>';
		$("#section").html(str);
	}


	function submitForm()
	{
		var column = $.trim($("#column").val());
		var nodes = $.trim($("#nodes").val());
		if(column=="" || nodes=="")
		{
			var notic = "所有项均不能为空!"
			$(".notic").html(notic);
			return false;
		}
		$.ajax({
			type:"GET",
			data:$("#sectionform").serialize(),
			url:"/auth/addsection/",
			dataType:"json",
			cache: false,
			success:function(data){
				if(data.code=="succ")
				{
					MsgUtil.show(data.msg);
					setTimeout(function(){window.location.reload()},1000);
				}else
				{
					MsgUtil.show(data.msg)
				}				
			}
		});
	}

	function bottonForm()
	{
		var column = $.trim($("#id").val());
		var nodes = $.trim($("#nodes").val());

		if(column=="" || nodes=="")
		{
			var notic = "所有项均不能为空!"
			$(".notic").html(notic);
			return false;
		}
		$.ajax({
			type:"GET",
			data:$("#sectionform").serialize(),
			url:"/auth/updateSection/",
			dataType:"json",
			cache: false,
			success:function(data){
				if(data.code=="succ")
				{
					$("#nodes").val("");
					MsgUtil.show(data.msg);
					setTimeout(function(){window.location.reload()},1000);
				}else
				{
					MsgUtil.show(data.msg)
				}				
			}
		});
	}

	function addAuth(id)
	{
		$("#layerbox").show();
		var pos = $("#m_"+id).offset();
		var tops = (pos.top);
		var lefts = (pos.left)-930;
		$("#layerbox").css({top:tops})
		$.ajax({
		   type: "POST",
		   url: "/auth/selectgrade/",
		   data: {'id':id},
		   success: function(data){
			$("#list").html(data)
		   }
		});
	}

	function del()
	{
		alert("还不能删~");
	}

	function close_layer()
	{
		$("#layerbox").toggle();
	}
	function checkAll()
	{
		alert("dd");
		return false;
		var code_Values = document.all['checks'];
		if(code_Values.length)
		{
			for(var i=0;i<code_Values.length;i++)
			{
				code_Values[i].checked = true;
				//var e=code_Values[i];
				// e.checked=!e.checked;
			}
		}else{
				code_Values.checked = false;
		}
	}
</script>

<div style="position: absolute; left:50%; margin-left:-465px; z-index: 1000099; display:none" id="layerbox">
	<div style="margin:0 0;padding:0 0" id="main-content" > <!-- Main Content Section with everything -->
		<div class="content-box ">
			<div class="content-box-header">
				<h3>添加权限</h3>
				<ul class="content-box-tabs">
		 <li><a href="javascript:void(0)" style="color:red" onclick="close_layer()">关闭</a> 
		</li>
		 
	</ul>
		</div> <!-- End .content-box-header -->
	<div class="content-box-content">
	<div id="tab" class="tab-content default-tab">
		<div id="list"></div>
		<div id="pass"></div>
	</div>
</div>
