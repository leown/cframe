<?php $adminuserobj = AdminuserSvc::getByEname($this->admin_user);?>
<aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel">
            <div class="pull-left image">
                <img src="http://img1.gximg.cn/v/static/images/logo.png" class="img-circle"
                alt="User Image">
            </div>
            <div class="pull-left info">
                <p>
                    <?php echo $this->adminuserobj->name;?>
                </p>
                <!-- 身份 -->
                <a><i class="fa fa-circle text-success"></i>
                    <?php echo $this->adminuserobj->role;?>
                </a>
            </div>
        </div>
        <!-- search form (Optional) -->
<!--         <form action="#" method="get" class="sidebar-form">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search...">
                <span class="input-group-btn">
                    <button type="submit" name="search" id="search-btn" class="btn btn-flat">
                        <i class="fa fa-search">
                        </i>
                    </button>
                </span>
            </div>
        </form> -->
        <!-- /.search form -->
        <!-- Sidebar Menu -->
        <ul class="sidebar-menu">
            <li class="header">
                Menu
            </li>
<?php
$admin_user = LoaderSvc::loadSess()->get('admin_user');
$adminuserobj = AdminuserSvc::getByEname($admin_user);

$curUid = $adminuserobj->id;
$haveauth = AuthsSvc::getAuthByUid($curUid);//已经有的权限
$tempArr = array();
//echo '$haveauth<br>';
//print_r($haveauth);
if('超级管理员' == $adminuserobj->role){
    $auths = MenuSvc::getMenus($haveauth,true);
}else{
    $auths = MenuSvc::getMenus($haveauth,false);
}
//echo '$auths<br>';
//print_r($auths);
$curr_submenus = array();

foreach($auths as $key=>$value)
{
    $nodsclass = MenuSvc::getByonclass($value['oneclass']);
    $tempArr[$value['oneclass']] = $nodsclass;
    foreach ($nodsclass as $_nodek =>$_nodev) {
        $curr_submenus[$value['oneclass']][] = $_nodev['curr_submenu'];
    }
}
?>
            <?php foreach ($tempArr as $key => $value): ?>
            <li class="treeview<?php if($this->curr_menu==$value[0]['curr_menu'] && in_array($this->curr_submenu, $curr_submenus[$key])){echo ' active';}?>">
                <a href="#">
                    <i class="fa<?php echo (isset(Menu::$ICON[$key])?' '.Menu::$ICON[$key]:' fa-circle'); ?>"></i>
                    <span><?php echo $key; ?></span>
                    <i class="fa fa-angle-left pull-right"></i>
                </a>
                <ul class="treeview-menu"<?php if($this->curr_menu==$value[0]['curr_menu']){echo ' active';}?>>
                    <?php foreach ($value as $v): ?>
                        <?php if(!in_array($v['aid'], $haveauth) && ('超级管理员' != $adminuserobj->role)) {
                            continue;
                        } ?>
                    <li<?php if($this->curr_submenu==$v['curr_submenu']){echo ' class="active"';}?>>
                        <a href="<?php echo $v['url']; ?>">
                        <i class="fa fa-circle-o text-aqua"></i>
                            <?php echo $v['name'] ;?>
                        </a>
                    </li>
                    <?php endforeach ?>
                </ul>
            </li>
            <?php endforeach ?>
            <!-- Optionally, you can add icons to the links -->
            <!-- <li class="active">
                <a href="#">
                    <i class="fa fa-link">
                    </i>
                    <span>
                        Link
                    </span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fa fa-link">
                    </i>
                    <span>
                        Another Link
                    </span>
                </a>
            </li>
            <li class="treeview">
                <a href="#">
                    <i class="fa fa-link">
                    </i>
                    <span>
                        Multilevel
                    </span>
                    <i class="fa fa-angle-left pull-right">
                    </i>
                </a>
                <ul class="treeview-menu">
                    <li>
                        <a href="#">
                            Link in level 2
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            Link in level 2
                        </a>
                    </li>
                </ul>
            </li> -->
        </ul>
        <!-- /.sidebar-menu -->
    </section>
    <!-- /.sidebar -->
</aside>