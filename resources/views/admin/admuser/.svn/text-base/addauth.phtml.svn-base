<?php $this->render( 'include/header', true ); ?>
<?php $this->render( 'include/lefter', true );
$album = $this->list;
?>
<script type="text/javascript" src="/static/js/popup_util.js"></script>
<script type="text/javascript" src="/static/js/msg_util.js"></script>
		<div id="main-content"> <!-- Main Content Section with everything -->
		
			
			<div class="content-box ">

				<div class="content-box-header">

					<h3>权限管理</h3>
					<ul class="content-box-tabs">
						<li><a href="/album/index/?islist=1" class="default-tab">列表</a></li> <!-- href must be unique and match the id of target div -->
						<!--<li><a href="/vipalbum/index/">新增</a></li>-->
					</ul>


				</div> <!-- End .content-box-header -->

				<div class="content-box-content">

					<div class="tab-content default-tab" id="refresh">

						<table id="selected">
							<tr id="lis">
								<th><h3>ID</h3></th>
								<th><h3>姓名</h3></th>
								<th><h3>邮箱</h3></th>
								<th><h3>部门</h3></th>
								<th><h3>职位</h3></th>
								<th><h3>系统角色</h3></th>
								<th><h3>操作</h3></th>
							</tr >
							<?php
							foreach($this->list['record'] as $v)
							{
								echo "<tr>";
								echo "<td>".$v['id']."</td>";
								echo "<td>".$v['name']."</td>";
								echo "<td>".$v['email']."</td>";
								echo "<td>".$v['depart']."</td>";
								echo "<td>".$v['position']."</td>";
								echo "<td>".$v['role']."</td>";
								echo "<td><img src='/static/admin/images/icons/cross.png' title='删除'>&nbsp;<a href='/auth/addauth/?id=".$v[id]."'><img src='/static/admin/images/icons/pencil.png' title='添加权限'></a></td>";
								echo "</tr>";
							}
							?>
						</table>
					</div> <!-- End #tab3 -->
				<hr>
				<details><summary><b>添加管理员</b></summary>
				<hr>
						<div>
							<form action = "/auth/add/" method="post" id="authform" name="authform">
							<fieldset>
								<p>姓名： <input class="text-input small-input" type="search" name="name" id="name" value="" required="required"/><span id="c_title"></span></p>
								<p>邮箱： <input class="text-input small-input" type="search" name="email" id="email" value="" required="required"/></p>
								<p>部门： <select id="depart" name="depart" required="required">
									<option value="">--请选择--</option>
									<option value="产品技术">--产品技术--</option>
									<option value="优米学院">--优米学院--</option>
									<option value="用户中心">--用户中心--</option>
									<option value="市场销售部">--市场销售部--</option>
								</select></p>
								<p>职位：<select id="position" name="position" required="required">
									<option value="">--请选择--</option>
									<option value="工程师">--工程师--</option>
									<option value="编辑">--编辑--</option>
									<option value="运营">--运营--</option>
								</select></p>
								<p>角色： <select id="role" name="role" required="required">
									<option value="">--请选择--</option>
									<option value="超级管理员">--超级管理员--</option>
									<option value="管理员">--管理员--</option>
									<option value="编辑">--编辑--</option>
								</select></p>
								<p><input class="button" type="button" value="新增" onclick=" return submitForm()">&nbsp;<span class="notic" style="color:red"></span></p>
								
							</fieldset> <!-- End #tab3 -->
							</form>
						</div>
					</details>
<?php $this->render( 'include/pager', true ); ?>
				</div> <!-- End .content-box-content -->
			
				
			</div> <!-- End .content-box -->


<?php $this->render( 'include/footer', true ); ?>
<script>
	function submitForm()
	{
		var name = $.trim($("#name").val());
		var email = $.trim($("#email").val());
		var depart = $.trim($("#depart").val());
		var position = $.trim($("#position").val());
		var role = $.trim($("#role").val());

		if(name=="" || email=="" || depart=="" || position=="" ||role=="")
		{
			var notic = "所有项均不能为空!"
			$(".notic").html(notic);
			return false;
		}
		$.ajax({
			type:"GET",
			data:$("#authform").serialize(),
			url:"/auth/add/",
			dataType:"json",
			cache: false,
			success:function(data){
				if(data.code=="succ")
				{
					var str = "<tr id='s"+data.data.id+"'><td>"+data.data.id+"</td><td>"+data.data.name+"</td><td>"+data.data.email+"</td><td>"+data.data.depart+"</td><td>"+data.data.position+"</td><td>"+data.data.role+"</td><td><img src='/static/admin/images/icons/cross.png' title='删除'>&nbsp;<a href='/auth/addauth/?id="+data.data.id+"'><img src='/static/admin/images/icons/pencil.png' title='添加权限'></a></td></tr>";
					$("#lis").after(str);
					$("#name").val("");
					$("#email").val("");
					$("#depart").val("");
					$("#position").val("");
					$("#role").val("");
					MsgUtil.show(data.msg)
				}else
				{
					MsgUtil.show(data.msg)
				}				
			}
		});
	}
</script>